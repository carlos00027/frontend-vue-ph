<template>
    <section class="container">
        <div  class="row justify-content-center align-items-center caja">
            <div class="col-12 col-sm-8 col-xl-4 py-3 shadow-lg" style="border-radius: 6px;">
                <validation-observer ref="el-form-login">
                    <form>
                        <div class="row">
                            <div class="col-12 text-center mb-3 d-flex flex-column justify-content-center">
                                <div class="my-0">
                                    <svg id="Capa_1" style="height: 120px; width:120px" enable-background="new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m119.485 153.168h-87.485v-77.501h30v47.501h57.485z" fill="#3c4a83"/><path d="m47 94c-25.916 0-47-21.084-47-47s21.084-47 47-47 47 21.084 47 47-21.084 47-47 47z" fill="#60e2f4"/><path d="m480 153.168h-85.629v-30h55.629v-47.501h30z" fill="#2a386b"/><path d="m465 94c-25.916 0-47-21.084-47-47s21.084-47 47-47 47 21.084 47 47-21.084 47-47 47z" fill="#29c5ec"/><path d="m62 436.333h-30v-77.501h85.628v30h-55.628z" fill="#3c4a83"/><path d="m47 512c-25.916 0-47-21.084-47-47s21.084-47 47-47 47 21.084 47 47-21.084 47-47 47z" fill="#60e2f4"/><path d="m480 436.333h-30v-47.501h-55.629v-30h85.629z" fill="#2a386b"/><path d="m465 512c-25.916 0-47-21.084-47-47s21.084-47 47-47 47 21.084 47 47-21.084 47-47 47z" fill="#29c5ec"/><path d="m15 241h60.667v30h-60.667z" fill="#3c4a83"/><path d="m436.333 241h60.667v30h-60.667z" fill="#2a386b"/><path d="m241 436.33h30v60.67h-30z" fill="#3c4a83"/><path d="m256 436.33h15v60.67h-15z" fill="#2a386b"/><path d="m241 15h30v60.67h-30z" fill="#3c4a83"/><path d="m256 15h15v60.67h-15z" fill="#2a386b"/><circle cx="256" cy="256" fill="#48588b" r="195.33"/><path d="m451.33 256c0 107.885-87.445 195.33-195.33 195.33v-390.66c107.885 0 195.33 87.445 195.33 195.33z" fill="#3c4a83"/><path d="m311.98 192.72v28.88h-30v-28.88c0-14.32-11.66-25.97-25.98-25.97s-25.98 11.65-25.98 25.97v28.88h-30v-28.88c0-30.86 25.11-55.97 55.98-55.97s55.98 25.11 55.98 55.97z" fill="#cddbf9"/><path d="m311.98 192.72v28.88h-30v-28.88c0-14.32-11.66-25.97-25.98-25.97v-30c30.87 0 55.98 25.11 55.98 55.97z" fill="#afc2e8"/><path d="m176.09 206.6v147.48h64.91l15-6.19 15 6.19h64.91v-147.48z" fill="#fea000"/><path d="m335.91 206.6v147.48h-64.91l-15-6.19v-141.29z" fill="#f78002"/><path d="m241 264.13h30v89.95h-30z" fill="#fbe200"/><path d="m256 264.13h15v89.95h-15z" fill="#febf01"/></svg>
                                </div>
                                <div>
                                    <h3 class="font-weight-bold">Inicio de sesión</h3>
                                </div>
                            </div>
                            <div class="col-12">
                                <validation-provider 
                                tag="div" 
                                name="correo electrónico"
                                class="input-group mb-3"
                                :rules="{required:true,max:100}"
                                v-slot="{errors,classes}"
                                >
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="basic-addon1">
                                            <i class="icon-user"></i>
                                        </span>
                                    </div>
                                    <input 
                                    v-model="form.email"
                                    type="email" 
                                    class="form-control" 
                                    :class="classes"
                                    placeholder="correo electrónico" 
                                    aria-label="Username" 
                                    aria-describedby="basic-addon1"
                                    >
                                    <span class="w-100 text-danger error">
                                        {{errors[0]}}
                                    </span>
                                </validation-provider>
                            </div>
                            <div class="col-12">
                                <validation-provider 
                                tag="div" 
                                name="password"
                                class="input-group mb-3"
                                :rules="{required:true,max:100}"
                                v-slot="{errors,classes}"
                                >
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="basic-addon1">
                                            <i class="icon-key"></i>
                                        </span>
                                    </div>
                                    <input 
                                    v-model="form.password"
                                    type="password" 
                                    class="form-control" 
                                    :class="classes"
                                    placeholder="contraseña" 
                                    aria-label="password" 
                                    aria-describedby="basic-addon1"
                                    @keyup.enter="ingresar"
                                    >
                                    <span class="w-100 text-danger error">
                                        {{errors[0]}}
                                    </span>
                                </validation-provider>
                            </div>
                            <div class="col-12">
                                <button 
                                type="button" 
                                class="btn btn-primary btn-block"
                                :disabled="cargando"
                                @click="ingresar"
                                >
                                    <span 
                                    class="spinner-border-sm" 
                                    :class="{'spinner-border': cargando}"
                                    role="status" 
                                    aria-hidden="true" 
                                    />
                                    Ingresar
                                </button>
                            </div>
                            <div class="col-12 my-2">
                                <router-link 
                                :to="{name: 'auth.registrar'}"
                                class="btn btn-outline-primary btn-block"
                                >
                                    Registrarme
                                </router-link>
                            </div>
                        </div>
                    </form>
                </validation-observer>
            </div>
            
        </div>
        <div class="derechos">
            <div class="d-flex align-items-center h-100">
                <div class="pr-2">
                    Coded By
                </div>
                <div style="height:36px; width:36px;">
                    <span>
                        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"> <g transform="translate(-1)"> <path style="fill:#8697CB;" d="M513,26.483v379.586H1L1,26.483C0.991,19.456,3.778,12.715,8.746,7.746S20.456-0.009,27.483,0 h459.034c7.027-0.009,13.768,2.778,18.736,7.746C510.222,12.715,513.009,19.456,513,26.483z"/> <rect x="212.862" y="414.897" style="fill:#A5A5A4;" width="88.276" height="79.448"/> <g> <path style="fill:#5E5F62;" d="M513,388.414v26.483c0.009,7.027-2.778,13.768-7.746,18.736c-4.969,4.969-11.71,7.756-18.736,7.746 H27.483c-7.027,0.009-13.768-2.778-18.737-7.746c-4.969-4.969-7.756-11.71-7.746-18.736l0-26.483H513z"/> <path style="fill:#5E5F62;" d="M195.207,476.69h132.414c19.501,0,35.31,15.809,35.31,35.31H159.897 C159.897,492.499,175.706,476.69,195.207,476.69z"/> </g> <g> <path style="fill:#ECF0F1;" d="M124.586,79.448h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655V44.138 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C142.229,71.539,134.332,79.436,124.586,79.448z M106.931,44.138v17.655h17.673l-0.018-17.655H106.931z"/> <path style="fill:#ECF0F1;" d="M89.276,158.897H71.621c-9.745-0.013-17.643-7.91-17.655-17.655v-17.655 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C106.918,150.987,99.021,158.884,89.276,158.897z M71.621,123.586v17.655h17.673l-0.018-17.655H71.621z"/> <path style="fill:#ECF0F1;" d="M62.793,79.448c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244V35.31 c0-4.875,3.952-8.828,8.828-8.828c4.875,0,8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C67.381,78.52,65.135,79.45,62.793,79.448z"/> <path style="fill:#ECF0F1;" d="M62.793,238.345c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828c4.875,0,8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C67.381,237.417,65.135,238.346,62.793,238.345z"/> <path style="fill:#ECF0F1;" d="M98.103,238.345c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828c4.875,0,8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C102.691,237.417,100.445,238.346,98.103,238.345z"/> <path style="fill:#ECF0F1;" d="M124.586,317.793c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828c4.875,0,8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C129.174,316.865,126.928,317.794,124.586,317.793z"/> <path style="fill:#ECF0F1;" d="M133.414,158.897c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828c4.875,0,8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C138.002,157.968,135.755,158.898,133.414,158.897z"/> <path style="fill:#ECF0F1;" d="M168.724,79.448c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244V35.31 c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C173.312,78.52,171.066,79.45,168.724,79.448z"/> <path style="fill:#ECF0F1;" d="M204.035,79.448c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244V35.31 c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C208.622,78.52,206.376,79.45,204.035,79.448z"/> <path style="fill:#ECF0F1;" d="M336.448,79.448h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655V44.138 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C354.091,71.539,346.194,79.436,336.448,79.448z M318.793,44.138v17.655h17.673l-0.018-17.655H318.793z"/> <path style="fill:#ECF0F1;" d="M371.759,158.897h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655v-17.655 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C389.401,150.987,381.504,158.884,371.759,158.897z M354.103,123.586v17.655h17.673l-0.018-17.655H354.103z"/> <path style="fill:#ECF0F1;" d="M407.069,238.345h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655v-17.655 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C424.712,230.435,416.814,238.332,407.069,238.345z M389.414,203.035v17.655h17.673l-0.018-17.655H389.414z"/> <path style="fill:#ECF0F1;" d="M451.207,317.793h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655v-17.655 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C468.849,309.883,460.952,317.78,451.207,317.793z M433.552,282.483v17.655h17.673l-0.018-17.655H433.552z"/> <path style="fill:#ECF0F1;" d="M80.448,317.793H62.793c-9.745-0.013-17.643-7.91-17.655-17.655v-17.655 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C98.091,309.883,90.194,317.78,80.448,317.793z M62.793,282.483v17.655h17.673l-0.018-17.655H62.793z"/> <path style="fill:#ECF0F1;" d="M265.828,79.448h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655V44.138 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C283.47,71.539,275.573,79.436,265.828,79.448z M248.172,44.138v17.655h17.673l-0.018-17.655H248.172z"/> <path style="fill:#ECF0F1;" d="M230.517,158.897h-17.655c-9.745-0.013-17.643-7.91-17.655-17.655v-17.655 c0.013-9.745,7.91-17.643,17.655-17.655h17.655c9.745,0.013,17.643,7.91,17.655,17.655v17.655 C248.16,150.987,240.263,158.884,230.517,158.897z M212.862,123.586v17.655h17.673l-0.018-17.655H212.862z"/> <path style="fill:#ECF0F1;" d="M380.586,79.448c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244V35.31 c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C385.174,78.52,382.928,79.45,380.586,79.448z"/> <path style="fill:#ECF0F1;" d="M415.897,79.448c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244V35.31 c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C420.484,78.52,418.238,79.45,415.897,79.448z"/> <path style="fill:#ECF0F1;" d="M451.207,79.448c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244V35.31 c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C455.795,78.52,453.549,79.45,451.207,79.448z"/> <path style="fill:#ECF0F1;" d="M415.897,158.897c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C420.484,157.968,418.238,158.898,415.897,158.897z"/> <path style="fill:#ECF0F1;" d="M345.276,238.345c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C349.864,237.417,347.618,238.346,345.276,238.345z"/> <path style="fill:#ECF0F1;" d="M389.414,317.793c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C394.002,316.865,391.755,317.794,389.414,317.793z"/> <path style="fill:#ECF0F1;" d="M451.207,158.897c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C455.795,157.968,453.549,158.898,451.207,158.897z"/> <path style="fill:#ECF0F1;" d="M274.655,158.897c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C279.243,157.968,276.997,158.898,274.655,158.897z"/> <path style="fill:#ECF0F1;" d="M309.966,158.897c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C314.553,157.968,312.307,158.898,309.966,158.897z"/> <path style="fill:#ECF0F1;" d="M451.207,238.345c-2.342,0.001-4.588-0.928-6.244-2.584c-1.656-1.656-2.585-3.902-2.584-6.244 v-35.31c0-4.875,3.952-8.828,8.828-8.828s8.828,3.952,8.828,8.828v35.31c0.001,2.342-0.928,4.588-2.584,6.244 C455.795,237.417,453.549,238.346,451.207,238.345z"/> </g> <path style="fill:#CBB292;" d="M200.051,288.016l24.968,24.968l-196.43,196.43c-3.447,3.447-9.037,3.447-12.484,0L3.62,496.93 c-3.447-3.447-3.447-9.037,0-12.484L200.051,288.016z"/> <path style="fill:#D1D4D1;" d="M274.655,264.828l29.043-29.043c3.443-3.469,3.443-9.066,0-12.535l-13.948-13.948 c-3.469-3.443-9.066-3.443-12.535,0l-29.043,29.043L274.655,264.828z"/> <path style="fill:#5E5F62;" d="M346.61,353.651c-1.97,1.778-4.565,2.7-7.215,2.563c-2.65-0.137-5.136-1.32-6.913-3.291 l-67.477-67.477l-27.538,27.538c-3.447,3.447-9.037,3.447-12.484,0l-24.968-24.968c-3.447-3.447-3.447-9.037,0-12.484 l27.538-27.538l-67.477-67.477c-1.971-1.776-3.155-4.263-3.291-6.913c-0.137-2.65,0.786-5.245,2.563-7.215 c2.947-2.778,7.322-3.405,10.931-1.568c38.781,18.288,74.097,43.164,104.376,73.522c30.358,30.279,55.234,65.595,73.522,104.376 C350.015,346.33,349.388,350.704,346.61,353.651z"/> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg>
                    </span> 
                </div>
                <div class="pl-2">
                    Carlos Sánchez
                </div>
            </div>
        </div>
    </section>
</template>

<script>
import {login} from '../../services/auth'
import { mensaje } from '../../utils/helper'
export default {
    layout: 'basic',
    middleware: 'guest',
    metaInfo: ()=>({title: 'Inicio de sesión'}),
    data(){
        return {
            cargando: false,
            form:{
                email: '',
                password: ''
            }
        }
    },
    mounted(){
        let email = this.$route.query.email
        if(email) this.form.email = email
    },
    methods:{
        async ingresar(){
            const esValido = await this.$refs['el-form-login'].validate()
            if(!esValido) return 
            
            try {
                this.cargando = true
                const {status,data} = await login(this.form)
                this.cargando = false
                if(status === 200){
                    await this.$store.dispatch('auth/saveToken',data)
                    await this.$store.dispatch('auth/fetchUser')
                    this.$router.push({name: 'Home'})
                }   
            } catch (error) {
                this.cargando = false
                console.error(error);
            }
        }
    }
}
</script>

<style lang="scss" scoped>
.caja{
    height: 100vh;
    
    .error {
        font-size: 12px;
    }
}
.derechos{
    position: fixed;
    bottom: 30px;
    right: 0px;
    display: flex;
    background: #eee;
    padding: 10px;
    box-shadow: 0 0 5px rgba(0,0,0,0.225);
    border-top-left-radius: 25px;
    border-bottom-left-radius: 25px;
}
</style>